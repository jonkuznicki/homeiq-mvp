<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>HomeIQ – Help Me With My Water Softener</title>
  <style>
    body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  max-width: 640px;
  margin: 32px auto;
  padding: 0 16px;
  line-height: 1.5;
  background: #f5f7fb;
}

h1 {
  font-size: 1.8rem;
  margin-bottom: 8px;
}

p {
  color: #444;
}

label {
  display: block;
  margin-top: 16px;
  font-weight: 600;
  font-size: 0.95rem;
}

textarea,
select,
input[type="file"] {
  width: 100%;
  margin-top: 4px;
}

textarea {
  min-height: 80px;
}

button {
  margin-top: 16px;
  padding: 10px 18px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background: #1e4fd9;
  color: white;
  font-weight: 600;
}

button:hover {
  background: #163ca4;
}

.result {
  margin-top: 24px;
  padding: 16px 18px;
  border-radius: 12px;
  background: white;
  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
}

ul, ol {
  padding-left: 20px;
}

#loading {
  margin-top: 12px;
  font-style: italic;
  color: #555;
}

  </style>
</head>
<body>
  <h1>Help Me With My Water Softener</h1>
  <p>Upload a photo and tell HomeIQ what's going on. We'll analyze it and suggest safe DIY steps.</p>

  <form id="help-form">
    <label>Photo of your system</label>
    <input type="file" id="photo" accept="image/*" required />

    <label>What's going on?</label>
    <textarea id="description" placeholder="Example: 'Our water is brown and pressure is low. Help me with this.'"></textarea>

<label>What is this related to?</label>
<select id="category">
  <option value="water_softener" selected>Water softener</option>
  <option value="lawn">Lawn / landscaping</option>
  <option value="dishwasher">Dishwasher</option>
  <option value="refrigerator">Refrigerator</option>
  <option value="pool">Pool / spa equipment</option>
  <option value="hvac">Furnace / HVAC</option>
  <option value="general">Something else / general DIY</option>
</select>


    <button type="submit">Get Help</button>
  </form>

  <div id="loading" style="display:none;margin-top:16px;">Analyzing your system…</div>

  <div id="result" class="result" style="display:none;">
    <h2>AI Diagnosis</h2>
    <div id="device_summary"></div>

    <h3>Likely Issues</h3>
    <ul id="likely_issues"></ul>

    <h3>DIY Steps</h3>
    <ol id="diy_steps"></ol>

    <h3>Warnings</h3>
    <ul id="warnings"></ul>

    <h3>When to Call a Pro</h3>
    <div id="when_to_call_pro"></div>
  </div>

  <script>
    const form = document.getElementById('help-form');
    const loading = document.getElementById('loading');
    const resultBox = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      	const fileInput = document.getElementById('photo');
	const descInput = document.getElementById('description');
	const categorySelect = document.getElementById('category');


      if (!fileInput.files[0]) {
        alert("Please upload a photo.");
        return;
      }

     	const formData = new FormData();
	formData.append('photo', fileInput.files[0]);
	formData.append('description', descInput.value || "help me with this");
	formData.append('category', categorySelect.value);


      loading.style.display = 'block';
      resultBox.style.display = 'none';

      try {
        const res = await fetch('/api/diagnose', {
          method: 'POST',
          body: formData
        });

        if (!res.ok) {
          throw new Error('Request failed');
        }

        const data = await res.json();

        document.getElementById('device_summary').innerText =
          data.device_summary || 'No summary available';

        const issuesContainer = document.getElementById('likely_issues');
        issuesContainer.innerHTML = '';
        (data.likely_issues || []).forEach(item => {
          const li = document.createElement('li');
          li.innerText = item;
          issuesContainer.appendChild(li);
        });

        const stepsContainer = document.getElementById('diy_steps');
        stepsContainer.innerHTML = '';
        (data.diy_steps || []).forEach(step => {
          const li = document.createElement('li');
          li.innerText = step;
          stepsContainer.appendChild(li);
        });

        const warningsContainer = document.getElementById('warnings');
        warningsContainer.innerHTML = '';
        (data.warnings || []).forEach(w => {
          const li = document.createElement('li');
          li.innerText = w;
          warningsContainer.appendChild(li);
        });

        document.getElementById('when_to_call_pro').innerText =
          data.when_to_call_pro || '';

        resultBox.style.display = 'block';
      } catch (err) {
        console.error(err);
        alert('Something went wrong. Please try again.');
      } finally {
        loading.style.display = 'none';
      }
    });
  </script>
</body>
</html>